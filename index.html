<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Logiktrainer 4×5</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 1rem 2rem 2rem 2rem;
      background: #f5f5f5;
      display: flex;
      justify-content: center;
    }
      td.block-top {
        border-top: 2px solid #ccc;
      }
      td.block-left {
        border-left: 2px solid #ccc;
      }
      td.block-right {
        border-right: 2px solid #ccc;
      }
      td.block-bottom {
        border-bottom: 2px solid #ccc;
      }
    .container {
      width: 90%;
      margin-top: 0;
    }

    textarea {
      width: 100%;
      height: 180px;
      margin-bottom: 1rem;
      padding: 1rem;
      font-family: monospace;
      font-size: 0.9rem;
    }

    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      background-color: #0077cc;
      color: white;
      border: none;
      border-radius: 4px;
    }

    .box {
      background-color: white;
      padding: 0.25rem 1.2rem;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      margin-bottom: 1rem;
    }

    #hints ul {
      padding-left: 1.2rem;
    }

    #hints li {
      margin-bottom: 0.5rem;
    }

    table {
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      table-layout: auto;
      width: auto;
      max-width: 100%;
    }

    th {
      border: 1px solid #ccc;
      font-size: 13px;
      padding: 0;
      height: 30px;
      font-weight: normal;
      text-align: center;
      vertical-align: middle;
    }

    td {
      border: 1px solid #ccc;
      padding: 0;
      height: 30px;
      text-align: center;
      font-size: 13px;
    }

      th.rotated {
        writing-mode: vertical-rl;
        transform: rotate(180deg);
        white-space: nowrap;
        text-align: center;
        vertical-align: middle;
        height: 100px;
        width: 30px;
        background-color: #f3f3f3;
      }

      th.rotated-left {
        writing-mode: vertical-lr;
        transform: rotate(180deg);
        white-space: nowrap;
        text-align: center;
        vertical-align: middle;
        background-color: #e0e0e0;
        font-size: 13px;
        height: 100px;
        width: 30px;
      }



    td[data-clickable] {
      cursor: pointer;
      background-color: #fff;
      width: 30px;
      aspect-ratio: 1 / 1;
    }

    td[data-clickable]:hover {
      background-color: #def;
    }

    td[data-state="1"] {
      background-color: #8f8;
    }

    td[data-state="0"] {
      background-color: #f88;
    }

    td[style*="border: none"] {
      background-color: #f5f5f5 !important;
    }
      #layoutRow {
          display: flex;
          gap: 2rem;
          align-items: flex-start;
        }

        #matrixContainer, #hints {
          flex: 1;
          max-width: 50%;
        }

        #hints {
          font-size: clamp(0.6rem, 1.5vw, 1rem);
          min-width: 250px;
          box-sizing: border-box;
        }
  </style>
</head>
<body>
  <div class="container">
    <div id="inputSection">
      <h1>Logiktrainer</h1>
      <p>Füge hier dein Rätsel ein (mit Einleitung, Hinweisen und 4 Kategorien mit je 5 Elementen):</p>
      <textarea id="csvInput" placeholder="Einleitungsgeschichte: ...\n\nHinweise:\n1. Hinweis...\n\nKategorien:\nKategorie;Element1,Element2,Element3,Element4,Element5"></textarea>
      <button onclick="generateMatrix()">Rätsel erstellen</button>
    </div>

    <div id="contentLayout" style="display: none;">
      <div id="introduction" class="box">
        <h2>Einleitung</h2>
        <p id="storyText"></p>
      </div>

      <div id="layoutRow">
        <div id="matrixContainer"></div>
        <div id="hints" class="box">
          <h2>Hinweise</h2>
          <ul id="hintsList"></ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    function generateMatrix() {
      const input = document.getElementById('csvInput').value.trim();
      const storyMatch = input.match(/Einleitungsgeschichte:\s*(.+?)\s*(Hinweise:|$)/s);
      const story = storyMatch ? storyMatch[1].trim() : '';
      const hintMatch = input.match(/Hinweise:\s*((?:\d+\..*?\n?)*)\s*Kategorien:/s);
      const hints = hintMatch ? hintMatch[1].trim().split(/\n+/).map(h => h.replace(/^\d+\.\s*/, '')) : [];
      const categoryMatch = input.match(/Kategorien:\s*((?:.+\n?)*)/);
      const categoryLines = categoryMatch ? categoryMatch[1].trim().split('\n') : [];

      const data = categoryLines.map(line => {
        const [category, elementsRaw] = line.split(';');
        return {
          category: category.trim(),
          elements: elementsRaw.split(',').map(e => e.trim())
        };
      });

      if (data.length !== 4 || !data.every(d => d.elements.length === 5)) {
        alert("Bitte genau 4 Kategorien mit je 5 Elementen eingeben.");
        return;
      }

      const [cat1, cat2, cat3, cat4] = data;
      const rowLabels = [...cat1.elements, ...cat4.elements, ...cat3.elements];
      const colLabels = [...cat2.elements, ...cat3.elements, ...cat4.elements];

      let html = '<table><thead>';
      html += '<tr><th rowspan="2" style="border: none; background-color: #f5f5f5;"></th><th rowspan="2" style="border: none; background-color: #f5f5f5;"></th>';
      [cat2.category, cat3.category, cat4.category].forEach(category => {
        html += `<th colspan="5" style="background-color: #e0e0e0; font-weight: normal;">${category}</th>`;
      });
      html += '</tr><tr>';
      colLabels.forEach(label => {
        const shortLabel = label.length > 13 ? label.slice(0, 12) + '.' : label;
        html += `<th class="rotated" title="${label}">${shortLabel}</th>`;
      });

      html += '</tr></thead><tbody>';

      const blockSize = 5;
      const totalSize = 15;
      const isBlockBorder = (index, size) => index % size === 0;

      function getBlockClasses(row, col) {
        const classes = [];
        if (isBlockBorder(row, blockSize)) classes.push('block-top');
        if (isBlockBorder(col, blockSize)) classes.push('block-left');
        if ((row + 1) % blockSize === 0) classes.push('block-bottom');
        if ((col + 1) % blockSize === 0) classes.push('block-right');
        return classes.join(' ');
      }

      
      rowLabels.forEach((label, rowIndex) => {
        if (rowIndex % 5 === 0) {
          const groupName = [cat1.category, cat4.category, cat3.category][Math.floor(rowIndex / 5)];
          html += `<tr><th rowspan="5" class="rotated-left">${groupName}</th>`;
        } else {
          html += '<tr>';
        }

        const shortLabel = label.length > 13 ? label.slice(0, 12) + '.' : label;
        html += `<th style="background-color: #f3f3f3;" title="${label}">${shortLabel}</th>`;
        colLabels.forEach((_, colIndex) => {
          if (
            (rowIndex >= 5 && rowIndex <= 9 && colIndex >= 10 && colIndex <= 14) ||
            (rowIndex >= 10 && rowIndex <= 14 && colIndex >= 5 && colIndex <= 14)
          ) {
            html += '<td style="border: none; background-color: #f5f5f5;"></td>';
          } else {
              const cellClass = getBlockClasses(rowIndex, colIndex);
              html += `<td data-clickable data-state="" class="${cellClass}" onclick="toggleCell(this)"></td>`;
          }
        });
        html += '</tr>';
      });

      html += '</tbody></table>';

      document.getElementById('storyText').textContent = story;
      document.getElementById('hintsList').innerHTML = hints.map(h => `<li>${h}</li>`).join('');
      document.getElementById('inputSection').style.display = 'none';
      document.getElementById('contentLayout').style.display = 'block';
      document.getElementById('matrixContainer').innerHTML = html;
    }

      function toggleCell(cell) {
        let state = cell.getAttribute('data-state');
        if (state === '') {
          cell.setAttribute('data-state', '1');
          cell.textContent = '+';
        } else if (state === '1') {
          cell.setAttribute('data-state', '0');
          cell.textContent = '–';
        } else {
          cell.setAttribute('data-state', '');
          cell.textContent = '';
        }
      }
  </script>
</body>
</html>
